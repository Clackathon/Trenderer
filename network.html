<!DOCTYPE HTML>
<html>
<head>
	<title>Network basic demo</title>
	<script src = "vis/dist/vis.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
	<link href = "vis/dist/vis.css" rel = "stylesheet" type = "text/css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.css" rel="stylesheet" type="text/css"/>
	<style type = "text/css">
		#mynetwork {
			position: absolute;
			top: 0;
			left: 0;
			height: 100%;
			width: 100%;
		}
	</style>
</head>
<body>
<div id = "mynetwork"></div>
<div id="dialog">placeholder content which will vanish</div>
<script type = "text/javascript">
	$("#dialog").dialog({ autoOpen: false });
	$.getJSON("./linked.json", function (jsondata) {
		var nodeArray = [];
		var linkArray = [];

		for (var key in jsondata) {
			var x = jsondata[key];
			nodeArray.push({id: x.mediaId, label: x.label});
			var linked = x.linkifiedImages;
			for (var link in linked) {
				linkArray.push({from: x.mediaId, to: link});
			}
		}

		console.log("Results:");
		console.log(nodeArray);
		console.log(linkArray);

		var nodes = new vis.DataSet(nodeArray);

		var edges = new vis.DataSet(linkArray);

		// create a network
		var container = document.getElementById('mynetwork');

		// provide the data in the vis format
		var data = {
			nodes: nodes,
			edges: edges
		};
		var options = {};

		function showPopup(nodeId) {
			var node = jsondata[nodeId];
			console.log("Node label " + node.label);
			console.log("Node b64: " + node.encodedThumbnail);

			$('#dialog').html(node.label + "<br />" + node.cloudVisionTags + "<br /><img src='data:image/jpg;base64," + node.encodedThumbnail + "'/>")
			$('#dialog').dialog('open');
		}

		// initialize your network!
		var network = new vis.Network(container, data, options);
		network.on('doubleClick', function (e) {
			console.log(e.nodes);
			if (e.nodes.length == 1)
				showPopup(e.nodes[0]);
		});
	});
</script>
</body>
</html>
